// fluxzk-nav-cute.js - Cria/injeta uma navbar fofa e funcional, respeitando os links do seu site.
document.addEventListener('DOMContentLoaded', function(){
    try{
        // --- 1. ESTILO "CUTE" (FOFO) INJETADO ---
        const cuteStyle = `
            .fluxzk-nav-cute {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 30px;
                background-color: #ffe4e1; /* Rosa claro/Pastel - Cor de Fundo */
                border-bottom: 3px solid #ffb6c1; /* Borda rosa mais forte */
                box-shadow: 0 4px 8px rgba(255, 182, 193, 0.6); /* Sombra suave */
                font-family: 'Quicksand', sans-serif; /* Fonte fofa */
                position: sticky;
                top: 0;
                z-index: 1000;
            }
            .fluxzk-nav-cute .brand {
                font-size: 26px;
                font-weight: bold;
                color: #ff69b4; /* Rosa Choque/Pink */
                letter-spacing: 1px;
                padding: 5px 10px;
                border: 2px dashed #ffb6c1; /* Borda tracejada fofa */
                border-radius: 15px;
            }
            .fluxzk-nav-cute .brand .fluxzk-link-accent {
                color: #8a2be2; /* Roxo suave */
            }
            .fluxzk-nav-cute .links {
                display: flex;
                align-items: center;
                gap: 10px; /* Espa√ßamento entre os links */
            }
            .fluxzk-nav-cute .links a {
                text-decoration: none;
                color: #4b0082; /* Roxo escuro para bom contraste */
                padding: 8px 15px;
                border-radius: 20px; /* Bordas arredondadas */
                transition: all 0.3s ease-in-out;
                font-weight: 700;
                position: relative;
            }
            .fluxzk-nav-cute .links a:hover,
            .fluxzk-nav-cute .links a.active {
                background-color: #ff69b4; /* Rosa Choque */
                color: white;
                transform: translateY(-3px) scale(1.05); /* Efeito "pulo" suave */
                box-shadow: 0 5px 15px rgba(255, 105, 180, 0.8);
            }

            /* --- SEPARADORES FOFOS (Opcional) --- 
            .fluxzk-nav-cute .links a:not(:last-child)::after {
                content: 'üíñ'; 
                color: #ff69b4;
                font-size: 10px;
                margin-left: 10px;
            }
            */

            @media (max-width: 768px) {
                .fluxzk-nav-cute {
                    flex-direction: column;
                    text-align: center;
                    padding: 10px;
                }
                .fluxzk-nav-cute .brand {
                    margin-bottom: 10px;
                }
                .fluxzk-nav-cute .links {
                    flex-wrap: wrap;
                    justify-content: center;
                }
                .fluxzk-nav-cute .links a {
                    margin: 5px 8px;
                    padding: 6px 12px;
                }
                .fluxzk-nav-cute .links a::after {
                    content: none;
                }
            }
        `;

        // 1. Injetar o estilo fofo no <head>
        const styleEl = document.createElement('style');
        styleEl.textContent = cuteStyle;
        document.head.appendChild(styleEl);

        // --- 2. MONTAGEM DA NAVBAR DIN√ÇMICA ---

        // Coletar se√ß√µes com id (features, about, gallery, faq)
        const sections = Array.from(document.querySelectorAll('#features, #about, #gallery, #faq')).filter(s => s.id);
        const linksData = sections.map(s => ({
            id: s.id,
            title: s.id.charAt(0).toUpperCase() + s.id.slice(1) // Capitaliza o ID (ex: Features)
        }));

        // Criar navbar HTML
        const nav = document.createElement('nav');
        nav.className = 'fluxzk-nav-cute'; 

        const brand = document.createElement('div');
        brand.className = 'brand';
        brand.innerHTML = '<span class="fluxzk-link-accent">‚ú® FluxZK</span> <span style="font-weight:500">Client</span>'; 

        const linksDiv = document.createElement('div');
        linksDiv.className = 'links';

        // 2.1 Link Home
        const homeA = document.createElement('a');
        homeA.href = '#';
        homeA.innerText = 'üè° Home';
        linksDiv.appendChild(homeA);
        
        // 2.2 Links Din√¢micos de Se√ß√µes
        linksData.forEach(l => {
            const a = document.createElement('a');
            a.href = '#'+l.id;
            a.innerText = l.title;
            a.setAttribute('data-target', l.id); 
            linksDiv.appendChild(a);
        });

        // 2.3 Links Fixos do Site Original
        const downloadA = document.createElement('a');
        downloadA.href = '/download';
        downloadA.innerText = 'üéÅ Download';
        linksDiv.appendChild(downloadA);

        const discordA = document.createElement('a');
        discordA.href = '/discord';
        discordA.innerText = 'üí¨ Discord';
        linksDiv.appendChild(discordA);

        nav.appendChild(brand);
        nav.appendChild(linksDiv);

        // Substituir o <header> existente que cont√©m o <nav> antigo
        const existingHeader = document.querySelector('.header');
        if(existingHeader){
            // Remove o nav e o hamburger que estavam dentro do header
            existingHeader.innerHTML = '';
            existingHeader.appendChild(nav);
        } else {
            // Caso n√£o tenha header (fallback)
            document.body.insertBefore(nav, document.body.firstChild);
        }

        // --- 3. IMPLEMENTA√á√ÉO DO SCROLL E DO ESTADO ATIVO ---

        const navLinks = document.querySelectorAll('.fluxzk-nav-cute a[href^="#"]');
        
        // Ativar Home por padr√£o
        document.querySelector('.fluxzk-nav-cute a[href="#"]').classList.add('active');


        // Scroll Suave
        navLinks.forEach(a=>{
            a.addEventListener('click', function(e){
                if(this.hash && document.querySelector(this.hash)){
                    e.preventDefault();
                    document.querySelector(this.hash).scrollIntoView({behavior:'smooth'});
                    
                    // L√≥gica para marcar o link clicado como ativo
                    navLinks.forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        // Observer para o Estado Ativo
        const navHeight = nav.offsetHeight;
        const observerOptions = {
            root: null, 
            // Aciona quando a se√ß√£o est√° a 10px abaixo da navbar
            rootMargin: `-${navHeight + 10}px 0px -70% 0px`, 
            threshold: 0
        };

        const observer = new IntersectionObserver(entries => {
            let activeId = null;
            
            // Encontra a se√ß√£o mais alta que est√° intersectando
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    activeId = entry.target.id;
                }
            });

            // Se uma se√ß√£o foi encontrada
            if (activeId) {
                navLinks.forEach(link => link.classList.remove('active'));
                const activeLink = document.querySelector(`.fluxzk-nav-cute a[data-target="${activeId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            } else if (window.scrollY < 10) {
                // Se estiver no topo, ativa o Home
                navLinks.forEach(link => link.classList.remove('active'));
                document.querySelector('.fluxzk-nav-cute a[href="#"]').classList.add('active');
            }

        }, observerOptions);

        // Observar todas as se√ß√µes (exceto a hero, que √© tratada pelo scrollY < 10)
        sections.forEach(sec => observer.observe(sec));


    }catch(e){
        console.warn('FluxZK nav injection failed', e);
    }
});
